<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/components/cards.css">
    <link rel="stylesheet" href="css/components/buttons.css">
    <link rel="stylesheet" href="css/components/forms.css">
    <link rel="stylesheet" href="css/pages/minha_colecao.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header-logged">
        <a href="dashboard.html">
            <img src="images/Logo.png" alt="Logo Figurama">
        </a>
        
        <nav class="nav-logged">
            <span>üë§ N_Usu√°rio</span>
            <a href="#">Cole√ß√£o</a>
            <input type="text" placeholder="Pesquisar">
            <button class="btn-add">Adicionar +</button>
        </nav>
    </header>

    <main class="colecao-container">

        <section class="colecao-info">
            <h1 id="title-colecao">{{colecao.nome}}</h1> <!-- Pega o nome da cole√ß√£o no Banco -->
            <p id="description">{{colecao.descricao}}</p> <!-- Pega o descri√ß√£o da cole√ß√£o no Banco -->
            <small>{{colecao.total_itens}} Action Figures</small> <!-- Pega o total da cole√ß√£o no Banco -->
            <hr>
        </section>

        <section class="card-grid1">
            <div class="cards1">
                <img src="{{action_figure.nome}}" alt="{{action_figure.nome}}">
                <h3>{{action_figure.nome}}</h3>
                <span class="status">{{item.status}}</span>
            </div>

            <!-- Isso ira se repetir no JS -->
        </section>

        <aside class="aside-edit">
            <span class="icone-usuario-aside">üë§</span> 
            <button id="btn-edit">Editar Cole√ß√£o</button>
            <small>Ultima modifica√ß√£o: {{colecao.data_update}}</small>
            <button id="btn-delete">Excluir Cole√ß√£o</button>
        </aside>
    </main>

    <script>
        // Dados da cole√ß√£o (vir√£o do backend)
let colecaoId = null;

// Carregar dados da cole√ß√£o
async function loadColecao() {
    // Pegar ID da URL (ex: colecao.html?id=123)
    const params = new URLSearchParams(window.location.search);
    colecaoId = params.get('id');
    
    if (!colecaoId) {
        alert('Cole√ß√£o n√£o encontrada');
        window.location.href = 'dashboard.html';
        return;
    }
    
    try {
        const response = await fetch(`/api/colecoes/${colecaoId}`);
        const data = await response.json();
        
        if (response.ok) {
            renderColecao(data);
        } else {
            alert('Erro ao carregar cole√ß√£o');
        }
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao conectar');
    }
}

// Renderizar informa√ß√µes da cole√ß√£o
function renderColecao(data) {
    document.getElementById('title-colecao').textContent = data.nome;
    document.getElementById('description').textContent = data.descricao;
    document.querySelector('.colecao-info small').textContent = `${data.total_itens} Action Figures`;
    document.querySelector('.aside-edit small').textContent = `√öltima modifica√ß√£o: ${formatDate(data.data_update)}`;
    
    // Renderizar cards
    renderCards(data.itens);
}

// Renderizar cards de action figures
function renderCards(itens) {
    const grid = document.querySelector('.card-grid1');
    grid.innerHTML = '';
    
    itens.forEach(item => {
        const card = document.createElement('div');
        card.className = 'cards1';
        card.innerHTML = `
            <img src="${item.imagem || 'images/placeholder.png'}" alt="${item.nome}">
            <h3>${item.nome}</h3>
            <span class="status">Na Cole√ß√£o</span>
        `;
        
        card.addEventListener('click', () => {
            window.location.href = `figure.html?id=${item.id}`;
        });
        
        grid.appendChild(card);
    });
}

// Formatar data
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('pt-BR');
}

// Editar cole√ß√£o
function editarColecao() {
    window.location.href = `editar-colecao.html?id=${colecaoId}`;
}

// Excluir cole√ß√£o
async function excluirColecao() {
    if (!confirm('Tem certeza que deseja excluir esta cole√ß√£o?')) return;
    
    try {
        const response = await fetch(`/api/colecoes/${colecaoId}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            alert('Cole√ß√£o exclu√≠da');
            window.location.href = 'dashboard.html';
        } else {
            alert('Erro ao excluir');
        }
    } catch (error) {
        alert('Erro ao conectar');
    }
}

// Inicializar
document.addEventListener('DOMContentLoaded', () => {
    loadColecao();
    document.getElementById('btn-edit').addEventListener('click', editarColecao);
    document.getElementById('btn-delete').addEventListener('click', excluirColecao);
});
    </script>
</body>
</html>