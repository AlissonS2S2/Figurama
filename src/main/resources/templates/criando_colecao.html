<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Figurama - Criar Cole√ß√£o</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .create-collection-box { max-width: 600px; margin: 50px auto; background: var(--dark); padding: 2rem; border-radius: 10px; }
        .create-collection-box h2 { text-align: center; color: var(--primary); margin-bottom: 2rem; }
    </style>
</head>
<body>
    <nav>
        <div class="logo"><h1>FIGURAMA</h1></div>
        <div>
            <a th:href="@{/dashboard}">Dashboard</a>
            <a th:href="@{/minha-colecao}">Minhas Figuras</a>
            <a th:href="@{/criar-colecao}">Criar Cole√ß√£o</a>
            <a href="#" onclick="logout()">Sair</a>
        </div>
    </nav>

    <div class="create-collection-box">
        <h2>üì¶ Criar Nova Cole√ß√£o</h2>
        <form id="criarColecaoForm">
            <label>Nome da Cole√ß√£o:</label>
            <input type="text" id="nome" required placeholder="Ex: Super-Her√≥is Marvel">
            
            <label>Descri√ß√£o:</label>
            <textarea id="descricao" placeholder="Descreva sua cole√ß√£o..." rows="4"></textarea>
            
            <button type="submit" class="btn" style="width: 100%; margin-top: 1rem;">Criar Cole√ß√£o</button>
        </form>
        
        <p style="text-align: center; margin-top: 1rem;">
            <a th:href="@{/minha-colecao}" style="color: var(--secondary);">‚Üê Voltar para Minhas Cole√ß√µes</a>
        </p>
    </div>

    <script>
        const user = JSON.parse(localStorage.getItem('user'));
        if(!user) window.location.href = '/login';

        document.getElementById('criarColecaoForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const nome = document.getElementById('nome').value.trim();
            const descricao = document.getElementById('descricao').value.trim();
            
            if (!nome) {
                alert('Por favor, informe o nome da cole√ß√£o.');
                return;
            }
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const textoOriginal = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Criando...';
            
            try {
                // Enviar requisi√ß√£o para criar cole√ß√£o
                const requestData = {
                    titulo: nome,
                    descricao: descricao,
                    quantidade: 0,
                    usuarioId: user.id
                };
                
                const response = await fetch('/colecoes/salvar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (response.ok) {
                    alert('Cole√ß√£o criada com sucesso!');
                    e.target.reset();
                    
                    // Redirecionar para minhas cole√ß√µes ap√≥s 1 segundo
                    setTimeout(() => {
                        window.location.href = '/minha-colecao';
                    }, 1000);
                    
                } else {
                    const errorText = await response.text();
                    alert('Erro ao criar cole√ß√£o: ' + errorText);
                }
                
            } catch (error) {
                console.error('Erro na requisi√ß√£o:', error);
                alert('Erro de conex√£o. Verifique sua internet e tente novamente.');
                
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = textoOriginal;
            }
        };

        function logout() {
            localStorage.removeItem('user');
            window.location.href = '/login';
        }
    </script>
</body>
</html>
